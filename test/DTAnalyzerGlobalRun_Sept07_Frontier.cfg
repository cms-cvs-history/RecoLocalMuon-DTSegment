
# Test the production of the complete chain:
# from digi to RecSegment 4D, through RecHit1D and RecSegment2D
# starting from real cosmic data from commissioning
# Up to now only the Linear Drift alogo is available for the
# commisioning data.
##

process testDTAnalyzer  = {


  include "CondCore/DBCommon/data/CondDBSetup.cfi"

############################################################################################    
#                 F I L E   R E A D E R 
############################################################################################    

# Event Formatter
    untracked PSet maxEvents = {
      untracked int32 input = 1000
    }

  source = PoolSource {
    untracked string fileMatchMode = "permissive"
      untracked uint32 firstRun = 0
      untracked uint32 firstEvent = 0
      untracked uint32 skipEvents = 0
      //untracked vstring fileNames = {'/store/data/GlobalSep07/A/000/020/734/RAW/0000/0294755E-276D-DC11-AC53-000423D69D4A.root'}
      untracked vstring fileNames = {'file:/raid3/data/YB0/GlobalRun_20734_4.root'}
  }


# avoid printout at each event...
  service = MessageLogger {
    untracked vstring categories = { "CosmicMuonProducer" , "CosmicMuonTrajectoryBuilder" }
    untracked vstring destinations = { "cout" }
    untracked vstring debugModules = { "*" }
    untracked vstring debugModules = { "CosmicMuonProducer" , "CosmicMuonTrajectoryBuilder" }
    untracked PSet cout = {
      untracked string threshold = "WARNING"
        untracked bool noLineBreaks = true
        untracked PSet WARNING = {untracked int32 limit = 0 }
    }
  }


############################################################################################    
#
#                 D T   U N P A C K I N G  
#
############################################################################################    


     #unpacker
     module dtunpacker = DTUnpackingModule {
     string dataType = "DDU"
     untracked bool fedbyType = true
     untracked bool useStandardFEDid = true
     PSet readOutParameters  = {
         untracked bool localDAQ = false
         untracked bool performDataIntegrityMonitor = false
         untracked bool debug = false
         PSet rosParameters = {
             untracked bool localDAQ = false
             untracked bool readingDDU = true  
             untracked bool writeSC = true
             untracked bool readDDUIDfromDDU = true
             untracked bool performDataIntegrityMonitor = false
             untracked bool debug = false
         }
     }
 }

    es_source DTMapping = PoolDBESSource {
        string timetype = "runnumber"
        #string connect = "oracle://cms_orcoff/CMS_COND_DT"
        #untracked string catalog = "relationalcatalog_oracle://cms_orcoff/CMS_COND_GENERAL"
        #untracked bool siteLocalConfig = false
        string connect = "frontier://Frontier/CMS_COND_DT"
        untracked string catalog = ""
        untracked bool siteLocalConfig = true

        string record = "DTReadOutMappingRcd"
        string tag = "DTChannelsMap"
        PSet DBParameters = {
            untracked int32 messageLevel = 0
            untracked string authenticationPath = "/afs/cern.ch/cms/DB/conddb"
        }
        VPSet toGet = {
            { string record = "DTReadOutMappingRcd"
                string tag = "GRESDTChannelsMap2" },
            { string record = "DTT0Rcd"
                string tag = "t0_SecTestYB0" },
            { string record = "DTTtrigRcd"
                string tag = "GREStTrig" }
        }
    }


  include "CondCore/DBCommon/data/CondDBSetup.cfi"

############################################################################################    
#
#                 R E C O N S T R U C T I O N 
#
############################################################################################    


    include "Geometry/CMSCommonData/data/cmsSimIdealGeometryXML.cfi"
#include "Geometry/MuonCommonData/data/muonIdealGeometryXML.cfi"
    include "Geometry/DTGeometry/data/dtGeometry.cfi"
    include "Geometry/CSCGeometry/data/cscGeometry.cfi"
    include "Geometry/MuonNumbering/data/muonNumberingInitialization.cfi"

    include "RecoLocalMuon/DTRecHit/data/dt1DRecHits_LinearDrift_CosmicData.cfi"
    include "RecoLocalMuon/DTSegment/data/dt2DSegments_CombPatternReco2D_LinearDrift_CosmicData.cfi"
    include "RecoLocalMuon/DTSegment/data/dt4DSegments_CombPatternReco4D_LinearDrift_CosmicData.cfi"


## Geometry
    include "Geometry/CommonDetUnit/data/globalTrackingGeometry.cfi"
    include "MagneticField/Engine/data/uniformMagneticField.cfi"
    include "RecoMuon/DetLayers/data/muonDetLayerGeometry.cfi"
    include "RecoMuon/MuonSeedGenerator/data/CosmicMuonSeedProducer.cfi"
    replace CosmicMuonSeed.EnableCSCMeasurement = false
    include "RecoMuon/CosmicMuonProducer/data/cosmicMuons.cfi"
    replace cosmicMuons.TrajectoryBuilderParameters.EnableDTMeasurement = true
    replace cosmicMuons.TrajectoryBuilderParameters.EnableCSCMeasurement = false
    replace cosmicMuons.TrajectoryBuilderParameters.EnableRPCMeasurement = false
#replace cosmicMuons.TrajectoryBuilderParameters.BackwardMuonTrajectoryUpdatorParameters.Granularity= 0

    include "TrackPropagation/SteppingHelixPropagator/data/SteppingHelixPropagator.cfi"


## _Reader_ ##
    module DTAnalyzer = DTAnalyzer {

      bool doHits = true
        bool doSegs = true
        bool doSA = true
        bool isMC = true
##      bool isMC = false
        untracked bool debug = false
        bool LCT_RPC = true
        bool LCT_DT = true
        bool LCT_CSC = true
        untracked string rootFileName = "DTAnalyzer.root"
        string DTLocalTriggerLabel = "dtunpacker"
####  string  digiLabel = "dtunpacker"
        string recHits1DLabel = "dt1DRecHits"
        string recHits2DLabel = "dt2DSegments"
        string recHits4DLabel = "dt4DSegments"
# The module to be used for ttrig synchronization and its paraemter set
        untracked string tTrigMode = 'DTTTrigSyncFromDB'
        untracked PSet tTrigModeConfig = {
          untracked bool debug = false
# The ttrig from the time box fit is defined as mean + kFactor * sigma
            double kFactor = -1.3
# The velocity of signal propagation along the wire (cm/ns)
            double vPropWire = 24.4
# Switch on/off the TOF correction from pulses
            bool doT0Correction = true   
# Switch on/off the TOF correction for particles
            bool doTOFCorrection = false 
# Switch on/off the correction for the signal propagation along the wire
            bool doWirePropCorrection  = false 
# The correction type for TOF
            int32 tofCorrType = 2
            int32 wirePropCorrType = 0
        }
      string SALabel = "cosmicMuons"
    }

## _Reader_ ##
  module STAnalyzer = STAnalyzer {

    bool doSA = true
      bool isMC = true
##      bool isMC = false
      untracked bool debug = false
      bool LCT_RPC = true
      bool LCT_DT = true
      bool LCT_CSC = true
      untracked string rootFileName = "DTAnalyzer.root"
      string DTLocalTriggerLabel = "dtunpacker"
      string recHits1DLabel = "dt1DRecHits"
      string recHits2DLabel = "dt2DSegments"
      string recHits4DLabel = "dt4DSegments"
# The module to be used for ttrig synchronization and its paraemter set
      untracked string tTrigMode = 'DTTTrigSyncFromDB'
      untracked PSet tTrigModeConfig = {
        untracked bool debug = false
# The ttrig from the time box fit is defined as mean + kFactor * sigma
          double kFactor = -1.3
# The velocity of signal propagation along the wire (cm/ns)
          double vPropWire = 24.4
# Switch on/off the TOF correction from pulses
          bool doT0Correction = true   
# Switch on/off the TOF correction for particles
          bool doTOFCorrection = false 
# Switch on/off the correction for the signal propagation along the wire
          bool doWirePropCorrection  = false 
# The correction type for TOF
          int32 tofCorrType = 2
          int32 wirePropCorrType = 0
      }
    string SALabel = "cosmicMuons"
      string PropagatorName = "SteppingHelixPropagator"
  }

## _Reader_ ##
  module DTEffAnalyzer = DTEffAnalyzer {
    bool isMC = true
##      bool isMC = false
      untracked bool debug = false
      bool LCT_RPC = true
      bool LCT_DT = true
      bool LCT_CSC = true
      untracked string rootFileName = "DTEffAnalyzer.root"
      string DTLocalTriggerLabel = "dtunpacker"
      string recHits1DLabel = "dt1DRecHits"
      string recHits2DLabel = "dt2DSegments"
      string recHits4DLabel = "dt4DSegments"
      int32 minHitsSegment = 5
      double minChi2NormSegment = 20.
      double minCloseDist = 20.
  }

path p = {dtunpacker, dt1DRecHits, dt2DSegments, dt4DSegments, CosmicMuonSeed, cosmicMuons, DTAnalyzer, DTEffAnalyzer}
#path p = {dtunpacker, dt1DRecHits, dt2DSegments, dt4DSegments, CosmicMuonSeed, cosmicMuons, STAnalyzer}
#path p = {dtunpacker, dt1DRecHits, dt2DSegments, dt4DSegments, DTAnalyzer, DTEffAnalyzer}
#path p = {dtunpacker, dt1DRecHits, dt2DSegments, dt4DSegments, standAloneCosmicMuons, DTAnalyzer}
#path p = {dtunpacker}

}

